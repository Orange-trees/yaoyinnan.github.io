<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>scrapy爬取知名技术文章网站（一） | Yaoyinnan's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">scrapy爬取知名技术文章网站（一）</h1><a id="logo" href="/.">Yaoyinnan's Blog</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">scrapy爬取知名技术文章网站（一）</h1><div class="post-meta">May 7, 2018</div><div class="post-content"><h2 id="确认爬取目标"><a href="#确认爬取目标" class="headerlink" title="确认爬取目标"></a>确认爬取目标</h2><p>明确网站（伯乐在线）的结构</p>
<p>比如说最新文章的url：<a href="http://blog.jobbole.com/all-posts/page/2/" target="_blank" rel="noopener">http://blog.jobbole.com/all-posts/page/2/</a></p>
<p>每一页的位置和最后的页码有关</p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/1.png" alt=""></p>
<p>方案1：通过页码的调整，存储文章列表所有url。（缺点：无法时时获得总页数）</p>
<p>方案2：通过判断是否有“下一页”的按钮，通过不断点击下一页来获取url。</p>
<h2 id="新建爬虫项目"><a href="#新建爬虫项目" class="headerlink" title="新建爬虫项目"></a>新建爬虫项目</h2><p>1.新建一个python虚拟环境（article_spider）</p>
<p>2.安装scrapy（可用豆瓣源）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install -i https://pypi.douban.com/simple/ scrapy</span></span><br></pre></td></tr></table></figure>
<p>3.在项目文件夹中创建爬虫项目（ArticleSpider）</p>
<p>4.在项目中创建爬虫模板（可自定义）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ArticleSpider</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> scrapy genspider example example.com</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/2.png" alt=""></p>
<p>5.导入article_spider虚拟环境</p>
<p>setting-&gt;interpreter–&gt;Add Local–&gt;虚拟环境</p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/3.png" alt=""></p>
<blockquote>
<p>注意：当点击右上角设置锯齿图标时，show all 后若有多个重名解释器时会提示错误</p>
</blockquote>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/error.png" alt=""></p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在根目录下创建main.py文件用于调试</p>
<p>main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">__author__ = <span class="string">"yaoyinnan"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy.cmdline <span class="keyword">import</span> execute</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">sys.path.append(os.path.dirname(os.path.abspath(__file__)))</span><br><span class="line">execute([<span class="string">"scrapy"</span>, <span class="string">"crawl"</span>, <span class="string">"jobbole"</span>])</span><br></pre></td></tr></table></figure>
<p>需要注意的是，在settings.py文件中将ROBOTSTXT_OBEY设置为False，否则的话爬虫会默认识别网站是否遵循ROBO协议，只爬去遵循的，爬虫会很快停止。</p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/4.png" alt=""></p>
<p>打断点，debug看response返回的内容</p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/5.png" alt=""></p>
<h2 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h2><h4 id="xpath简介"><a href="#xpath简介" class="headerlink" title="xpath简介"></a>xpath简介</h4><p>1.xpath使用路径表达式在xml和html中进行导航</p>
<p>2.xpath包含标准函数库</p>
<p>3.xpath是一个w3c的标准</p>
<h4 id="xpath节点关系"><a href="#xpath节点关系" class="headerlink" title="xpath节点关系"></a>xpath节点关系</h4><p>1.父节点</p>
<p>2.子节点</p>
<p>3.同胞结点</p>
<p>4.先辈结点</p>
<p>5.后代结点</p>
<h4 id="xpath语法"><a href="#xpath语法" class="headerlink" title="xpath语法"></a>xpath语法</h4><p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/6.png" alt=""></p>
<blockquote>
<p>/ 一层</p>
<p>// 无论多少层</p>
<p>@ 属性</p>
</blockquote>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/7.png" alt=""></p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/8.png" alt=""></p>
<blockquote>
<p>| 求并集</p>
</blockquote>
<h2 id="应用xpath编写逻辑代码"><a href="#应用xpath编写逻辑代码" class="headerlink" title="应用xpath编写逻辑代码"></a>应用xpath编写逻辑代码</h2><p>jobbole.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobboleSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'jobbole'</span></span><br><span class="line">    allowed_domains = [<span class="string">'blog.jobbole.com'</span>]</span><br><span class="line">    start_urls = [<span class="string">'http://blog.jobbole.com/113942/'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        re_selector1 = response.xpath(<span class="string">"/html/body/div[1]/div[3]/div[1]/div[1]/h1/text()"</span>)</span><br><span class="line">        re_selector2 = response.xpath(<span class="string">'//*[@id="post-113942"]/div[1]/h1/text()'</span>)</span><br><span class="line">        re_selector3 = response.xpath(<span class="string">'//*[@class="entry-header"]/h1/text()'</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>通过检查–&gt;右键–&gt;copy path–&gt;获得网页结构xpath</p>
<p>方法一：“绝对path”，从头开始一级一级往下写xpath</p>
<p>方法二：通过ID，每个id都是固定的，用离着所需标签最短的id缩短xpath</p>
<p>方法三：通过不重复的Class，方式同ID</p>
<blockquote>
<p>注意：这里的“第几个div”是从1开始数，和数组从0开始不一致。</p>
</blockquote>
<p>通过python每次debug太慢了，可以通过shell命令进行爬取</p>
<p>先进入虚拟环境下的项目中，再输入：</p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/10.png" alt=""></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> scrapy shell url</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/11.png" alt=""></p>
<p>在shell中成功的代码要复制回pycharm</p>
<p>进一步爬取：title、time、favour</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobboleSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'jobbole'</span></span><br><span class="line">    allowed_domains = [<span class="string">'blog.jobbole.com'</span>]</span><br><span class="line">    start_urls = [<span class="string">'http://blog.jobbole.com/113942/'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        title = response.xpath(<span class="string">'//*[@class="entry-header"]/h1/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        create_date = response.xpath(<span class="string">'//*[@id="post-113942"]/div[2]/p/text()'</span>).extract()[<span class="number">0</span>].strip().replace(<span class="string">"·"</span>, <span class="string">""</span>).strip()</span><br><span class="line">        favour = response.xpath(<span class="string">'//*[@id="113942votetotal"]/text()'</span>).extract()[<span class="number">0</span>] + <span class="string">"赞"</span></span><br><span class="line"></span><br><span class="line">        print(title)</span><br><span class="line">        print(create_date)</span><br><span class="line">        print(favour)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>extract() : 提取，返回的是一个数组</p>
<p>extract()[0] :  数组的第一个元素</p>
<blockquote>
<p>可以用extract_first()，取第零个上面数组下标的方式获取时需要做异常处理，而这种无需。</p>
<blockquote>
<p>并且可以加参数，参数作为提取不到的返回值</p>
</blockquote>
</blockquote>
<p>replace() : 替换</p>
<p>strip() ： 移出字符串尾指定字符，默认为空格</p>
<p>完整代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobboleSpider</span><span class="params">(scrapy.Spider)</span>:</span></span><br><span class="line">    name = <span class="string">'jobbole'</span></span><br><span class="line">    allowed_domains = [<span class="string">'blog.jobbole.com'</span>]</span><br><span class="line">    start_urls = [<span class="string">'http://blog.jobbole.com/113942/'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        title = response.xpath(<span class="string">'//*[@class="entry-header"]/h1/text()'</span>).extract()[<span class="number">0</span>]</span><br><span class="line">        create_date = response.xpath(<span class="string">'//*[@id="post-113942"]/div[2]/p/text()'</span>).extract()[<span class="number">0</span>].strip().replace(<span class="string">"·"</span>, <span class="string">""</span>).strip()</span><br><span class="line">        praise_nums = response.xpath(<span class="string">'//*[@id="113942votetotal"]/text()'</span>).extract()[<span class="number">0</span>] + <span class="string">"赞"</span></span><br><span class="line">        content = response.xpath(<span class="string">'//div[@class="entry"]'</span>).extract()</span><br><span class="line">        tag_list = response.xpath(<span class="string">'//p[@class="entry-meta-hide-on-mobile"]/a/text()'</span>).extract()</span><br><span class="line">        tag_list = [element <span class="keyword">for</span> element <span class="keyword">in</span> tag_list <span class="keyword">if</span> <span class="keyword">not</span> element.strip().endswith(<span class="string">"评论"</span>)]</span><br><span class="line">        tags = <span class="string">","</span>.join(tag_list)</span><br><span class="line">        print(title)</span><br><span class="line">        print(create_date)</span><br><span class="line">        print(praise_nums)</span><br><span class="line">        print(content[<span class="number">0</span>])</span><br><span class="line">        print(tag_list)</span><br><span class="line">        print(tags)</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/12.png" alt=""></p>
<p>去除评论：[element for element in tag_list if not element.strip().endswith(“评论”)]</p>
<p>用“,”连接数组元素：”,”.join(tag_list)</p>
<h2 id="CSS选择器"><a href="#CSS选择器" class="headerlink" title="CSS选择器"></a>CSS选择器</h2><p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/13.png" alt=""></p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/14.png" alt=""></p>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/15.png" alt=""></p>
<p>具体方式不列举：</p>
<blockquote>
<p>这里只放视频中的一段代码</p>
</blockquote>
<p><img src="/2018/05/07/scrapy爬取知名技术文章网站（一）/16.png" alt=""></p>
</div><div class="tags"><a href="/tags/python/">python</a></div><div class="post-nav"><a class="pre" href="/2018/05/12/图像处理名词/">图像处理名词</a><a class="next" href="/2018/05/03/爬虫技术基础知识/">爬虫技术基础知识</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/ThinkPHP/" style="font-size: 15px;">ThinkPHP</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/common/" style="font-size: 15px;">common</a> <a href="/tags/图像处理/" style="font-size: 15px;">图像处理</a> <a href="/tags/文献推荐/" style="font-size: 15px;">文献推荐</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/05/20/MOOC-ThinkPHP基础篇-5-8模板的布局-包含和继承/">MOOC-ThinkPHP基础篇-5-8模板的布局 包含和继承</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/20/MOOC-ThinkPHP基础篇-5-6比较标签 5-7条件判断标签/">MOOC-ThinkPHP基础篇-5-6比较标签 5-7条件判断标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/20/MOOC-ThinkPHP基础篇-5-5模板循环标签/">MOOC-ThinkPHP基础篇-5-5模板循环标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/20/MOOC-ThinkPHP基础篇-5-4变量输出-调节器/">MOOC-ThinkPHP基础篇-5-4变量输出 调节器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/20/MOOC-ThinkPHP基础篇-5-3系统变量原生标签/">MOOC-ThinkPHP基础篇-5-3系统变量原生标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/12/图像处理名词/">图像处理名词</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/07/scrapy爬取知名技术文章网站（一）/">scrapy爬取知名技术文章网站（一）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/03/爬虫技术基础知识/">爬虫技术基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/02/Python虚拟环境/">Python虚拟环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/26/文献管理系统设计方案/">文献管理系统设计方案</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Yaoyinnan's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>